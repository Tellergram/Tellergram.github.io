<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8">
        <title>IRC Log Formatter</title>
        <link rel="stylesheet" type="text/css" href="normalize.css">
        <style>
            body, html {
                background-color: #FFFFFF;
                color: #000;
                font: 14px "Times New Roman, Times, serif;";
                margin: 0px;
            }
            .nav {
                background-color: rgb(158, 171, 197);
                position: fixed;
                top:0;
                left:0;
                width: 400px;
                bottom:0;
                overflow-y: auto;
            }
            .nav .content {
                padding: 0 5px;            
            }
            .nav .label_wrapper {
                padding: 5px;
                margin: 5px 0 5px 0;
                border-top: 1px solid #000;
                border-bottom: 1px solid #000;
                background: rgba(0, 0, 0, .2);
            }
            .nav hr {
                border-bottom: 1px dotted rgba(0, 0, 0, .5);
            }
            span.label {
                font-weight: 700;
                display: block;
            }
            span.label a{
                text-decoration: none;
                color: #0000FF;
            }
            span.label a:visited{
                color: #0000FF;
            }
            span.label a:hover{
                color: #FFFFFF;
            }
            #input {
                width: 100%;
                height: 150px;
                background-color: #FFFFFF;
                padding: 3px;
                box-sizing: border-box;
                border: 1px solid rgba(0, 0, 0, .75);
                overflow-x: hidden;
                overflow-y: scroll;
            }
            .input_small {
                width: 100%;
            }
            .input_button {
                padding: 5px;
                width: 80px;
            }
            #output {
                padding: 10px;
                margin-left: 400px;
            }
            td {
                vertical-align: top
            }

            td.label {
                width: 80px;
                text-align: right;
                font-weight: 700;
                padding: 5px 2px;
            }
            .debug {
                position: fixed;
                bottom: 0;
                right: 0;
            }
        </style>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
        <!--<script src="//ajax.googleapis.com/ajax/libs/angularjs/1.4.3/angular.min.js"></script>-->
        <script>
            irc_log_formatter = (function() {
                var parent = {
                    //POST
                    Post: function() {
                        return {
                            nick: '',
                            gm: false,
                            lines: []
                        }
                    },
                    
                    //FORMATTED STRING
                    FString: function(str, bold_format, italics_format) {
                        var bold_depth = (typeof bold_format == 'undefined' || bold_format == false) ? 0 : 1,
                            italics_depth = (typeof italics_format == 'undefined' || italics_format == false) ? 0 : 1, 
                            obj = {
                                plain_text: '',
                                bold: [],
                                italics: [],
                                indexOf: function (a) { return this.plain_text.indexOf(a); },
                                charAt: function (a) { return this.plain_text.charAt(a); },
                                substring: function (a, b) { return this.plain_text.substring(a, b); },
                                get text() {
                                    var output = '', bold = 0, italics = 0;
                                    for (var i = 0; i < this.plain_text.length; i++) {
                                        if (this.bold[i] != null) {
                                            if (this.bold[i] > bold && bold == 0) output += '<b>';
                                            if (this.bold[i] < bold && this.bold[i] == 0) output += '</b>';
                                            bold = this.bold[i];
                                        }
                                        if (this.italics[i] != null) {
                                            if (this.italics[i] > italics && italics == 0) output += '<i>';
                                            if (this.italics[i] < italics && this.italics[i] == 0) output += '</i>';
                                            italics = this.italics[i];
                                        }
                                    
                                        output += this.plain_text.charAt(i);
                                    }
                                    if (italics > 0) output += '</i>';
                                    if (bold > 0) output += '</b>';
                                    for (var i = 0; i < this.plain_text.length; i++)
                                    
                                    return output;
                                },
                                ltrim: function () {
                                    var l = this.plain_text.length;
                                    this.plain_text = this.plain_text.replace(/^[ \r\n\t]+/, '');
                                    if (this.plain_text.length - l > 0) {
                                        this.bold.splice(0, this.plain_text.length - l);
                                        this.italics.splice(0, this.plain_text.length - l);
                                    }
                                    return this;
                                },
                                rtrim: function () {
                                    var l = this.plain_text.length;
                                    this.plain_text = this.plain_text.replace(/[ \r\n\t]+$/, '');
                                    if (this.plain_text.length - l > 0) {
                                        this.bold.splice(this.bold.length - (this.plain_text.length - l));
                                        this.italics.splice(this.italics.length - (this.plain_text.length - l));
                                    }
                                    return this;
                                },
                                trim: function () {
                                    return this.ltrim().rtrim();
                                },
                                splice: function (a, b, c) {
                                    if (typeof b == 'undefined') b = this.plain_text.length - a;
                                    if (typeof c == 'undefined') c = '';
                                    this.plain_text = this.plain_text.substring(0, a) + c + this.plain_text.substring(a + b);
                                    this.bold.splice(a, b);
                                    this.italics.splice(a, b);
                                    for (var i = 0, len = c.length; i < len; i++) {
                                        this.bold.splice(a, 0, null);
                                        this.italics.splice(a, 0, null);
                                    }
                                    return this;
                                },
                                startswith: function (a) {
                                    return (this.plain_text.substring(0, a.length) == a);
                                },
                                endswith: function (a) {
                                    return (this.plain_text.substring(this.plain_text.length - a.length) == a);
                                },
                                concat: function (str) {
                                    this.plain_text += str.plain_text;
                                    this.bold.extend(str.bold);
                                    this.italics.extend(str.italics);
                                },
                                toString: function() {
                                    return this.text;
                                },
                                length: function() {
                                    return this.plain_text.length;
                                }
                            }
                        
                        var i = 0;
                        while (i < str.length) {
                            var token = str.charAt(i);
                            
                            //TAGS
                            if (token == '<') {
                                var token_complete = false;
                                while (!token_complete && i < str.length) {
                                    i++;
                                    var addendum = str.charAt(i);
                                    token += addendum;
                                    if (addendum == '>') token_complete = true;
                                }
                                if (token == '<b>') bold_depth++;
                                if (token == '</b>') bold_depth--;
                                if (token == '<i>') italics_depth++;
                                if (token == '</i>') italics_depth--;
                                if (token.substr(0,3) == '<br') {
                                    token = '\n';
                                } else {
                                    token = '';
                                }
                            }
                            
                            //TOKENS
                            if (token.length > 0) {
                                obj.plain_text += token;
                                for (var j = 0; j < token.length; j++) {
                                    obj.bold.push(bold_depth);
                                    obj.italics.push(italics_depth);
                                }
                            }
                            i++;
                        }
                        return obj;
                    },
                    
                    //INITIAL SETTINGS
                    input: "",
                    settings: {
                        gm: "Teller|GM",
                        player: "",
                        output_header: "",
                        output_gm_post: "<p><b>[NICK]</b></p><p>[POST]</p><hr>",
                        output_player_post: "<p><b>[NICK]</b></p><p>[POST]</p><hr>",
                        output_footer: "",
                        merge_consecutive_posts: true,
                        detect_dots: true,
                        remove_comments: false,
                        remove_end: true,
                        output_delimiter: "<p>"                
                    },
                    
                    //PRESETS
                    format_divided: function() {
                        parent.settings.output_header = "";
                        parent.settings.output_gm_post = "<p><b>[NICK]</b></p><p>[POST]</p><hr>";
                        parent.settings.output_player_post = "<p><b>[NICK]</b></p><p>[POST]</p><hr>";
                        parent.settings.output_footer = "";
                        parent.settings.output_delimiter = "<p>";
                        parent.settings.merge_consecutive_posts = true;
                        parent.settings.remove_end = true;
                        parent.settings.format_paragraphs = true;
                        parent.dom_pull_data();
                        parent.cache.save();
                    },
                    format_table: function() {
                        parent.settings.output_header = "<table>";
                        parent.settings.output_gm_post = "<tr><td><b><p>[NICK]</p></b></td><td><p><b>[POST]</b></p></td></tr>";
                        parent.settings.output_player_post = "<tr><td><p>[NICK]</p></b></td><td><p>[POST]</p></td></tr>";
                        parent.settings.output_footer = "</table>";
                        parent.settings.merge_consecutive_posts = true;
                        parent.settings.remove_end = true;
                        parent.settings.format_paragraphs = true;
                        parent.dom_pull_data();
                        parent.cache.save();
                    },
                    format_paragraph: function() {
                        parent.settings.output_header = "";
                        parent.settings.output_gm_post = "<p><b>[NICK]</b></p><p>[POST]</p><br />";
                        parent.settings.output_player_post = "<p><b>[NICK]</b></p><p>[POST]</p><br />";
                        parent.settings.output_footer = "";
                        parent.settings.merge_consecutive_posts = true;
                        parent.settings.remove_end = true;
                        parent.settings.format_paragraphs = true;
                        parent.dom_pull_data();
                        parent.cache.save();
                    },
                    format_plain: function() {
                        parent.settings.output_header = "";
                        parent.settings.output_gm_post = "<p>&lt;[NICK]&gt; [POST]</p>";
                        parent.settings.output_player_post = "<p>&lt;[NICK]&gt; [POST]</p>";
                        parent.settings.output_footer = "";
                        parent.settings.merge_consecutive_posts = false;
                        parent.settings.remove_end = false;
                        parent.settings.format_paragraphs = false;
                        parent.dom_pull_data();
                        parent.cache.save();
                    },
                    
                    //DOM MODEL
                    dom_push_data: function() {
                        $('[data-model]').each(function(index, e){
                            var model = $(e).attr('data-model').split("."), current = parent;
                            while (model.length > 1) current = current[model.shift()];
                            if ($(e).is(':checkbox')) {
                                current[model[0]] = $(e).prop('checked');
                            } else if ($(e).is('div')) {
                                current[model[0]] = $(e).html();
                            } else {
                                current[model[0]] = $(e).val();
                            }
                        });
                    },
                    dom_pull_data: function() {
                        $('[data-model]').each(function(index, e){
                            var model = $(e).attr('data-model').split("."), current = parent;
                            while(model.length > 1) current = current[model.shift()];
                            if ($(e).is(':checkbox')) {
                                $(e).prop('checked', current[model[0]]);
                            } else if ($(e).is('div')) {
                                $(e).html(current[model[0]]);
                            } else {
                                $(e).val(current[model[0]]);
                            }                                                                                                
                        });
                    },                    
                    
                    //CACHE
                    cache: {
                        timer: null,
                        save: function () {
                            parent.dom_push_data();
                            if (parent.cache.timer != null) clearTimeout(parent.cache.timer);
                            parent.cache.timer = setTimeout(function() {
                                if (typeof(Storage) !== "undefined"){
                                    localStorage.setItem("settings", JSON.stringify(parent.settings));
                                    localStorage.setItem("input", parent.input);
                                }
                                parent.cache.timer = null;
                            }, 3000);
                        },
                        load: function() {
                            if (typeof(Storage) !== "undefined"){
                                var settings = localStorage.getItem("settings");
                                if (settings == null){
                                    parent.cache.save();
                                }else{
                                    parent.input = localStorage.getItem("input");
                                    var parsed_data = JSON.parse(settings);
                                    for (var attrname in parsed_data) parent.settings[attrname] = parsed_data[attrname];
                                    parent.dom_pull_data();
                                }
                            }
                        }
                    },
                    
                    //HIGHLIGHT OUTPUT
                    highlight_output: function() {
                        var node = document.getElementById("output");
                        if ( document.selection ) {
                            var range = document.body.createTextRange();
                            range.moveToElementText( node  );
                            range.select();
                        } else if ( window.getSelection ) {
                            var range = document.createRange();
                            range.selectNodeContents( node );
                            window.getSelection().removeAllRanges();
                            window.getSelection().addRange( range );
                        }
                    },
                    
                    //FETCH DATA FROM URL
                    get_from_url: function(txt) {
                        var return_string = "";
                        if (txt.indexOf("pastebin.com") !== -1) { //Dealing with a pastebin
                            if (txt.indexOf("raw.php?i=") !== -1) { //A blessing on your house, you've given us the raw url
                                var url = 'http://pastebin.com/raw.php?i=' + txt.substr(txt.indexOf("?i=") + 3);
                            } else { //assume normal pastebin url
                                var url = 'http://pastebin.com/raw.php?i=' + txt.substr(txt.substr(0, txt.length - 1).lastIndexOf("/") + 1);
                            }
                        } else if (txt.indexOf("irccloud.com") !== -1){ //Dealing with an irccloud pastebin
                            var url='https://www.irccloud.com/pastebin/raw/' + txt.substr(txt.substr(0, txt.length-1).lastIndexOf("/") + 1);
                        }
                        
                        $.ajax({
                            url: "https://cors-anywhere.herokuapp.com/" + url,
                            success: function (result) {
                                return_string = result;
                            },
                            async: false
                        });
                        return return_string;
                    },
                    
                    //CONVERT
                    convert: function() {
                        parent.dom_push_data();
                        if (parent.input.length < 200 && /^((ftp|http|https):\/\/)?([a-zA-Z0-9]+(\.[a-zA-Z0-9]+)+.*)$/.test(parent.input.trim())){ //Dealing with url
                            parent.input = parent.get_from_url(parent.input.trim('/n'));
                            parent.input = parent.input.replace(/&/g, "&amp;")
                                                   .replace(/</g, "&lt;")
                                                   .replace(/>/g, "&gt;")
                                                   .replace(/\n(\r)?/g,"<br>");
                            
                            $("#input").html(parent.input);
                            parent.cache.save();
                        }
                        parent.output(parent.input);
                    },
                    
                    //PROCESS OUTPUT
                    output: function(input) {
                        //POSSIBLE STYLES
                        var BRACKET_STYLE = 0;
                        var COLON_STYLE = 1;
                        var LINEBREAK_STYLE = 2;
                        
                        var style = BRACKET_STYLE;
                    
                        //BUILD LIST OF NICKS
                        var gm_nicks = $.map(parent.settings.gm.split(","), $.trim),
                            player_nicks = $.map(parent.settings.player.split(","), $.trim),
                            all_nicks = gm_nicks.concat(player_nicks);
                            if (parent.settings.format_rolls) all_nicks.push('[ATM]');
                            escaped_nicks = $.map( all_nicks, function(str) { return str.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g, "\\$&"); }).join('|'),
                            nicks_re = new RegExp("(&lt;)?(~|•|\\+|@|%)?(" + escaped_nicks + ")(:)?(&gt;)?[ ]*");
                            
                        //BREAK INPUT DOWN INTO FORMATTED LINES
                        var lines = [], pre_lines = $.map(input.replace(/<br\s*[\/]?>/gi,"\n").match(/[^\r\n]+/g), function (v, i) {
                            return parent.FString(v);
                        });
                        
                        //PRE-PROCESS LINES
                        for (var i = 0, i_len = pre_lines.length; i < i_len; i++) {
                            var line = pre_lines[i];
                        
                            //TRIM LINE
                            line.trim();
                        
                            //STRIP TIME
                            var match = /^\[?(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)?[-1234567890: ]{4,24}[APMapm]{0,2} ?\]? +/.exec(line.plain_text);
                            if (match) line.splice(0, match[0].length);
                            
                            //DISCARD LINES WITH SUSPECT CHARACTERS
                            if (line.trim().length == 0)  continue; //Blank Line
                            if (line.indexOf(String.fromCharCode(9432)) !== -1)  continue; //(nickchange, Antioch logs)
                            if (line.indexOf(String.fromCharCode(8592)) !== -1)  continue; //(left/quit, Antioch logs)
                            if (line.indexOf(String.fromCharCode(8594)) !== -1)  continue; //(joined, Antioch logs)
                            if (line.indexOf(String.fromCharCode(8596)) !== -1)  continue; //(nipped out, Antioch logs)
                            if (line.indexOf(String.fromCharCode(8656)) !== -1)  continue; //(left, Panda logs)
                            if (line.startswith('&lt;-&gt;')) continue; //(nickchange, Nick logs)
                            if (line.startswith('&lt;--')) continue; //(left, Nick logs)
                            if (line.startswith('--&gt;')) continue; //(joined, Nick logs)
                            if (line.charAt(0) =="#") continue; //(irccloud header)
                            
                            //CHECK FOR USERNAMES
                            var match = nicks_re.exec(line.plain_text);
                            if (match) {
                                if (match[1] && match[5]) style = BRACKET_STYLE;
                                if (match[4]) style = COLUMN_STYLE;
                                if (match[0] == line.plain_text) style = LINEBREAK_STYLE;
                            }
                            
                            //ADD TO PROCESSED LINES
                            lines.push(line);
                        }
                        delete pre_lines;
                        
                        //BUILD OUTPUT
                        var posts = [], current_post = new parent.Post();
                        
                        for (var i = 0, i_len = lines.length; i < i_len; i++) {
                            var line = lines[i];
                            
                            //MATCH & REMOVE NICK
                            var match_nick = nicks_re.exec(line.plain_text);
                            if (match_nick) line.splice(0, match_nick.index + match_nick[0].length);
                            
                            //MATCH ROLLS
                            if (match_nick && match_nick[3] == '[ATM]') {
                                if (line.indexOf('=') != -1) { //FORMAT AS A ROLL
                                    var match_roll = /.*?[ ](".*?")?[ ]?(.*)/.exec(line);
                                    if (match_roll[1]) {
                                        line = parent.FString("&nbsp;&nbsp;&nbsp;&nbsp;ROLL: " + match_roll[1] + " " + match_roll[2], true, false);
                                    } else {
                                        line = parent.FString("&nbsp;&nbsp;&nbsp;&nbsp;ROLL: \"?&\" " + match_roll[2], true, false);
                                    }
                                } else {
                                    line = parent.FString("&nbsp;&nbsp;&nbsp;&nbsp;WOUND: " + line.plain_text, true, false);
                                }
                            }
                            
                            //REMOVE PLAYER ROLLS
                            if (parent.settings.format_rolls && line.startswith("$")) continue;
                            
                            //REMOVE COMMENTS
                            if (parent.settings.remove_comments && (line.startswith("((") || line.endswith("))"))) continue;
                            
                            //REMOVE ...
                            var match = /^\.{3,6}$/.exec(line.plain_text);
                            if (match) continue;

                            //REMOVE ||, //, >>
                            var match = /(-)?[|\>\/]{1,8}$/.exec(line.plain_text);
                            if (match) line.splice(match.index, match[0].length);
                            
                            //CONVERT ITALICS
                            if (parent.settings.detect_italics){
                                var match = /\/([^\/><]+)\//.exec(line.plain_text);
                                while (match) {
                                    line.splice(match.index, match[0].length, '<i>' + match[1] + '</i>');
                                    match = /\/([^\/><]+)\//.exec(line.plain_text);
                                }
                            }
                            
                            //UPDATE NICK
                            if (match_nick && match_nick[3] != '[ATM]') {
                                if (current_post.nick && (current_post.nick != match_nick[3] || !parent.settings.merge_consecutive_posts)) { //Start a new post
                                    posts.push(current_post);
                                    current_post = new parent.Post();
                                }
                                current_post.nick = match_nick[3];
                                current_post.gm = (gm_nicks.indexOf(match_nick[3]) !== -1);
                            }
                            
                            //MERGE LINES ENDING WITH ... OR ADD LINE
                            if (line.plain_text) {
                                var last_line = (current_post.lines) ? current_post.lines[current_post.lines.length - 1] : null;
                                if (parent.settings.detect_dots && last_line && line.startswith('...') && last_line.endswith('...')) {
                                    line.splice(0, 3);
                                    last_line.splice(last_line.length - 3);
                                    last_line.concat(line);
                                } else {
                                    current_post.lines.push(line);
                                }
                            }
                        }
                        posts.push(current_post);
                        
                        //PRINT OUTPUT
                        var output = parent.settings.output_header;
                        for (var i = 0, i_len = posts.length; i < i_len; i++) {
                            if (posts[i].nick && posts[i].lines) {
                                if (posts[i].gm){ //GM Post
                                    output += parent.settings.output_gm_post.replace('[NICK]', posts[i].nick)
                                                                            .replace('[POST]', posts[i].lines.join(parent.settings.output_delimiter));
                                } else {
                                    output += parent.settings.output_player_post.replace('[NICK]', posts[i].nick)
                                                                                .replace('[POST]', posts[i].lines.join(parent.settings.output_delimiter));
                                }
                            }
                        }
                        output += parent.settings.output_footer;
                        
                        //FORMAT Paragraphs
                        if (parent.settings.format_paragraphs){
                            output = output.split('<hr><p>').join('<hr><p style="\
                                margin-top:7pt;\
                                margin-bottom:7pt;\
                                font-size: 14.666666666666666px;\
                                font-family: Arial;\
                                color: rgb(0, 0, 0);\
                                background-color: transparent;\
                                font-weight: 400;\
                                font-style: normal;\
                                font-variant: normal;\
                                text-decoration: none;\
                                vertical-align: baseline;\
                                line-height: 1.15;">');
                            output = output.split('<p>').join('<p style="\
                                margin-top:0pt;\
                                margin-bottom:7pt;\
                                font-size: 14.666666666666666px;\
                                font-family: Arial;\
                                color: rgb(0, 0, 0);\
                                background-color: transparent;\
                                font-weight: 400;\
                                font-style: normal;\
                                font-variant: normal;\
                                text-decoration: none;\
                                vertical-align: baseline;\
                                line-height: 1.15;">');
                            output = output.split('<td>').join('<td style="padding: 0pt 3pt;">');
                        }

                        $('#output').html(output);
                    },
                    
                    //DEBUG
                    debug: function () {
                        var debug = {
                            input: parent.input,
                            settings: parent.settings
                        };
                        $('#output').html(JSON.stringify(debug));
                    },
                    
                    //IMPORT
                    debug_import: function() {
                        var json = JSON.parse(prompt());
                        parent.input = json.input;
                        parent.settings = json.settings;
                        parent.dom_pull_data();
                    }
                }
                return parent;
            })();
            
            //Paste
            $(document).ready(function(){
                $('#input').bind('kepress keyup keydown', function() { irc_log_formatter.cache.save() });
            
                $('[contenteditable]').on('paste',function(e) {
                   var clip_data = (e.originalEvent || e).clipboardData;
                    if (clip_data.getData('text/html')) {
                        e.preventDefault();
                        var text = clip_data.getData('text/html');
                        var $result = $('<div></div>').append($(text));

                        $(this).html($result.html());
                        
                        // remove all empty tags
                        $(this).contents()
                        .filter(function(){ return this.nodeType == 8; })
                        .remove();                        

                        // replace all styles except bold and italic
                        $.each($(this).find("*"), function(idx, val) {
                            var $item = $(val);
                            if ($item.length > 0){
                                var font_weight = $item.css('font-weight'),
                                    font_style = $item.css('font-style'),
                                    display = $item.css('display'),
                                    position = $item.css('position');

                                if ($item.is('b') || font_weight == 'bold' || (!isNaN(parseFloat(font_weight)) && parseFloat(font_weight) > 400)) {
                                    $item.wrap('<b></b>');
                                }

                                if ($item.is('i') || font_style == 'italic' || font_style == 'oblique') {
                                    $item.wrap('<i></i>');
                                }
                                
                                if ($item.is('p') || $item.is('br') || (display == 'block' && position != 'absolute')) {
                                    $item.after('<br />');//wrap('<div></div>');
                                }
                                if ($item.is('pre')) {
                                    $item.html($item.html().replace(/\n(\r)?/g,"<br>"));
                                }
                                
                                $item.contents().unwrap();
                                
                                if ($item.is('br')) $item.remove();
                            }
                        });
                    } else if (clip_data.getData('text/rtf')) {
                        e.preventDefault();
                        var text = clip_data.getData('text/rtf');
                        
                        //Remove first and last {} group
                        var index = text.indexOf('{');
                        text = text.slice(0, index) + text.slice(index + 1);
                        
                        var index = text.lastIndexOf('}');
                        text = text.slice(0, index) + text.slice(index + 1);
                        
                        //Escape curly brackets & HTML
                        text = text.replace(/&/g, "&amp;")
                                   .replace(/\\{/g, "&#123;")
                                   .replace(/\\}/g, "&#125;")
                                   .replace(/</g, "&lt;")
                                   .replace(/>/g, "&gt;");
                        
                        //Delete Groups
                        var reg = new RegExp(/{[^{]*?}/), match;   
                        while (match = reg.exec(text)) {
                            text = text.slice(0, match.index) + text.slice(match.index + match[0].length);
                        }
                        
                        //Delete & Replace Tags
                        var reg = new RegExp(/\\[a-zA-Z0-9]*/), match, insert;   
                        while (match = reg.exec(text)) {
                            insert = '';
                            if (match[0] == '\\par' || match[0] == '\\n') insert = '<br />';
                            if (match[0] == '\\b') insert = '<b>';
                            if (match[0] == '\\b0') insert = '</b>';
                            if (match[0] == '\\i') insert = '<i>';
                            if (match[0] == '\\i0') insert = '</i>';
                            
                            text = text.slice(0, match.index) + insert + text.slice(match.index + match[0].length);
                        }
                        
                        
                                                
                            /*.replace(ctrlCharPattern, "")
                        
                        
                        var basicRtfPattern = /\{\*?\\[^{}]+;}|[{}]|\\[A-Za-z]+\n?(?:-?\d+)?[ ]?/g;
                        var newLineSlashesPattern = /\\\n/g;
                        var ctrlCharPattern = /\n\\f[0-9]\s/g;

                        //Remove RTF Formatting, replace RTF new lines with real line breaks, and remove whitespace
                        text = text
                            /*.replace(ctrlCharPattern, "")
                            .replace(basicRtfPattern, "")
                            .replace(newLineSlashesPattern, "<br />")
                            .trim();*/
                        
                        $(this).html(text);
                    } else if (clip_data.getData('text/plain')) {
                    
                    }
                    irc_log_formatter.cache.save();
                });          
            
            });   
        </script>
    </head>
    <body onload="irc_log_formatter.cache.load()">
        <div class="nav">
            <!--Input-->
            <div class="label_wrapper">
                <span class="label">Raw Log Input (URL or text)</span>
            </div>
            <div class="content">
                <div id="input" contenteditable data-model="input"></div>
            </div>
            
            <!--Settings-->
            <div class="label_wrapper">
                <span class="label">Settings</span>
                <font size="2">
                    <i>Placeholders: [NICK] [POST]<br />
                    Separate multiple GM/player names with a comma.</i>
                </font>
            </div>
            <div class="content">
                <table width="100%">
                    <tr>
                        <td class="label">GM(s)</td>
                        <td><input type="text" class="input_small" onchange="irc_log_formatter.cache.save()" data-model="settings.gm"></input></td>
                        <td class="label">Player(s)</td>
                        <td><input type="text" class="input_small" onchange="irc_log_formatter.cache.save()" data-model="settings.player"></input></td>
                    </tr>
                    <tr>
                        <td class="label">GM Post</td>
                        <td><input type="text" class="input_small" onchange="irc_log_formatter.cache.save()" data-model="settings.output_gm_post"></input></td>
                        <td class="label">Player Post</td>
                        <td><input type="text" class="input_small" onchange="irc_log_formatter.cache.save()" data-model="settings.output_player_post"></input></td>
                    </tr>
                    <tr>
                        <td class="label">Header</td>
                        <td><input type="text" class="input_small" onchange="irc_log_formatter.cache.save()" data-model="settings.output_header"></input></td>
                        <td class="label">Footer</td>
                        <td><input type="text" class="input_small" onchange="irc_log_formatter.cache.save()" data-model="settings.output_footer"></input></td>
                    </tr>
                </table>
            </div>
            <hr />
            <div class="content">
                <table width="100%">
                    <tr>
                        <td>
                            <input type="checkbox" onchange="irc_log_formatter.cache.save()" data-model="settings.merge_consecutive_posts"> Merge Consecutive Posts<br />
                            <input type="checkbox" onchange="irc_log_formatter.cache.save()" data-model="settings.format_paragraphs"> Format CSS<br />
                            <input type="checkbox" onchange="irc_log_formatter.cache.save()" data-model="settings.format_rolls"> Format Rolls<br />
                            <input type="checkbox" onchange="irc_log_formatter.cache.save()" data-model="settings.detect_italics"> Detect /italics/<br />
                        </td>
                        <td>
                            <input type="checkbox" onchange="irc_log_formatter.cache.save()" data-model="settings.remove_end"> Remove "||", "//", and ">>"<br />
                            <input type="checkbox" onchange="irc_log_formatter.cache.save()" data-model="settings.detect_dots"> Merge on start/end "..."<br />
                            <input type="checkbox" onchange="irc_log_formatter.cache.save()" data-model="settings.remove_comments"> Remove ((Comments))<br />
                        </td>
                    </tr>
                </table>
            </div>
            <div class="label_wrapper">
                <span class="label">
                    Presets:
                    <a href="#" onclick="irc_log_formatter.format_plain()">Plain</a> |
                    <a href="#" onclick="irc_log_formatter.format_table()">Table</a> |
                    <a href="#" onclick="irc_log_formatter.format_paragraph()">Paragraph</a> |
                    <a href="#" onclick="irc_log_formatter.format_divided()">Divided</a>
                </span>
            </div>
            <center><button class="input_button" onclick="irc_log_formatter.convert()">Convert</button>&nbsp;<button class="input_button" onclick="irc_log_formatter.highlight_output()">Highlight</button></center>
            <button class="debug" onclick="irc_log_formatter.debug()">?</button>
        </div>
        <div id="output"></div>
    </body>
</html>
